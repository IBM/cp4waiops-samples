{"version":3,"file":"AlertWidget.js","names":["Renderer","constructor","options","content","iframeId","getId","containerId","getContainer","canvas","features","on","payload","contentID","info","events","contentId","document","getElementById","parentNode","id","dataPointSelection","getContent","getFeature","inputColumnMapping","getPropertyList","forEach","item","getPropertyValue","getColumnMapping","value","JSON","parse","ex","iframeAlertsWidget","contentWindow","postMessage","source","params","widgetdata","getSelections","transformations","columnmapping","data","name","filterName","filtername","window","location","origin","viewName","viewname","showToolbar","showtoolbar","showDetails","showdetails","columnMapping","messageHandler","addEventListener","getAPI","render","domNode","destroy","renderControl","replace","innerHTML","host","parent","Promise","resolve","_default","_exports","default"],"sources":["../../ext/alert-list/AlertWidget.js"],"sourcesContent":["/* ******************************************************** {COPYRIGHT-TOP} ****\n * IBM Confidential\n * 5725-Q09, 5737-M96\n * Â© Copyright IBM Corp. 2023, 2024\n ********************************************************* {COPYRIGHT-END} ****/\nclass Renderer {\n  constructor(options) {\n    this.content = options.content;\n    this.iframeId = `${this.content.getId()}_alertsWidget`;\n    this.containerId = this.content.getContainer().getId();\n\n    this.canvas = options.features['Dashboard.Canvas'];\n    this.canvas.on('change:content:selections', (payload) => {\n      const contentID = payload.info.events[0].info.contentId;\n      const containerId = document.getElementById(contentID).parentNode.id;\n      const dataPointSelection = this.canvas\n        .getContent(contentID)\n        .getFeature('DataPointSelections');\n      let inputColumnMapping;\n      this.content.getPropertyList().forEach((item) => {\n        if (item.id === 'inputColumnMapping') {\n          inputColumnMapping = item.getPropertyValue();\n        }\n      });\n\n      const getColumnMapping = (value) => {\n        try {\n          return JSON.parse(value);\n        } catch (ex) {\n          return value;\n        }\n      };\n\n      if (containerId === this.containerId) {\n        inputColumnMapping = getColumnMapping(inputColumnMapping);\n        const iframeAlertsWidget = document.getElementById(this.iframeId);\n        iframeAlertsWidget.contentWindow.postMessage(\n          {\n            source: 'dashboard',\n            params: {\n              widgetdata: dataPointSelection.getSelections(),\n              transformations: { columnmapping: inputColumnMapping }\n            }\n          },\n          '*'\n        );\n      }\n    });\n\n    this.content.on('change:property', (data) => {\n      const iframeAlertsWidget = document.getElementById(this.iframeId);\n\n      if (data?.info?.events[0].name === 'change:property:dropdownFilter') {\n        const filterName = data?.info?.events[0].info.value;\n        iframeAlertsWidget.contentWindow.postMessage({ source: 'dashboard', params: { filtername: filterName } }, window.location.origin);\n      }\n\n      if (data?.info?.events[0].name === 'change:property:dropdownView') {\n        const viewName = data?.info?.events[0].info.value;\n        iframeAlertsWidget.contentWindow.postMessage({ source: 'dashboard', params: { viewname: viewName } }, window.location.origin);\n      }\n\n      if (data?.info?.events[0].name === 'change:property:toggleToolbar') {\n        const showToolbar = data?.info?.events[0].info.value;\n        iframeAlertsWidget.contentWindow.postMessage({ source: 'dashboard', params: { showtoolbar: showToolbar } }, window.location.origin);\n      }\n\n      if (data?.info?.events[0].name === 'change:property:toggleDetails') {\n        const showDetails = data?.info?.events[0].info.value;\n        iframeAlertsWidget.contentWindow.postMessage({ source: 'dashboard', params: { showdetails: showDetails } }, window.location.origin);\n      }\n\n      if (data?.info?.events[0].name === 'change:property:inputColumnMapping') {\n        let columnMapping = data?.info?.events[0].info.value;\n\n        const getColumnMapping = (value) => {\n          try {\n            return JSON.parse(value);\n          } catch (ex) {\n            return value;\n          }\n        };\n\n        columnMapping = getColumnMapping(columnMapping);\n        iframeAlertsWidget.contentWindow.postMessage(\n          {\n            source: 'dashboard',\n            params: { transformations: { columnmapping: { columnMapping } } }\n          },\n          window.location.origin\n        );\n      }\n    });\n\n    this.messageHandler = ({data}) => {\n      // send event to the widget only if the event source widget shares the same parent\n      if (data.containerId === this.containerId) {\n        document.getElementById(this.iframeId).contentWindow.postMessage(data, '*');\n      }\n    };\n\n    window.addEventListener('message', this.messageHandler, false);\n  }\n\n  getAPI() {\n    return {\n      render: (domNode) => this.render(domNode)\n    };\n  }\n\n  destroy() {}\n\n  renderControl() {\n    let filterName = '';\n    let viewName = '';\n    let showToolbar = true;\n    let showDetails = false;\n\n    this.content.getPropertyList().forEach((item) => {\n      if (typeof item.getPropertyValue() !== 'undefined'  && item.id === 'dropdownView') {\n        viewName = item.getPropertyValue();\n        viewName = viewName.replace(/ /g, '+');\n      } else if (typeof item.getPropertyValue() !== 'undefined' && item.id === 'dropdownFilter') {\n        filterName = item.getPropertyValue();\n        filterName = filterName.replace(/ /g, '+');\n      } else if (typeof item.getPropertyValue() !== 'undefined' && item.id === 'toggleToolbar') {\n        showToolbar = item.getPropertyValue();\n      } else if (typeof item.getPropertyValue() !== 'undefined' && item.id === 'toggleDetails') {\n        showDetails = item.getPropertyValue();\n      }\n    });\n\n    this.parentNode.innerHTML =\n      \"<iframe id='\" + this.iframeId + \"' src='https://\" + window.location.host + '/aiops/default/widgets/alerts?showtoolbar=' +\n      showToolbar +\n      '&showdetails=' +\n      showDetails +\n      '&filtername=' +\n      filterName +\n      '&viewname=' +\n      viewName +\n      '&containerid=' +\n      this.containerId +\n      \"' title='AIOPS Alerts widget' frameBorder='0' width='100%' height='100%'></iframe>\";\n  }\n\n  render(options) {\n    this.parentNode = options.parent;\n    this.renderControl();\n    return Promise.resolve();\n  }\n}\n\nexport default Renderer;\n"],"mappings":"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","ignoreList":[]}